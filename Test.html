<html>
<head>
    <style>
        #message { display: none}
        #loading {
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 100;
        width: 100vw;
        height: 100vh;
        background-color: rgba(192, 192, 192, 0.5);
        background-repeat: no-repeat;
        background-position: center;
    }
    </style>
</head>
<body>

<div id="message">

<p><h1 style="color:Orange;">Congratulations! Visualisation Plugins appear to be working on your SynBioHub</h1></p>
<p>URL sent: URL_REPLACE</p>
<p>URI sent: URI_REPLACE</p>
<p>Instance sent: INSTANCE_REPLACE</p>
<p>Full data sent: REQUEST_REPLACE </p>

</div>

<div id="loading">
    <object data="loading_gif.html" width="500" height="300"></object>
    <h3 class="text-center" id="state_txt">Waiting for response...</h3>
</div>
<script>
    function onReady(callback) {
    var intervalID = window.setInterval(checkReady, 1000);

    function checkReady() {
        const entryPoint = fetch('http://3.128.188.117:80/plugin_poll/34a1793970dad7fcd3f6e46e2229ad57');
        entryPoint.then((response) => {
                if (!response.ok) {
                    throw new Error("HTTP status " + response.status);
                }
                return response.json();
            })
            .then((result) => {
                const state  = result.State;
                console.log(state);
                document.getElementById("state_txt").textContent = state;
                if (state == "Done") {
                    window.clearInterval(intervalID);
                    callback.call(this);
                }
            })
            .catch((e) => {
                console.log(e);
                window.clearInterval(intervalID);

            })
    }
}

function show(id, value) {
    document.getElementById(id).style.display = value ? 'block' : 'none';
}

onReady(function () {
    show('message', true);
    show('loading', false);
});
</script>
</body>

</html>
